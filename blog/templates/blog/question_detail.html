{% extends 'layouts/base.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}

<div class ="d-flex">

    <div class="card" style="width: 69.5rem; height: 17rem">

        <h5 class="card-header">  
                  {% for tag in question.tag.all %} 
          <a href="{% url 'blog:questions-in-tags' tag.slug %}" class="btn btn-outline-Success btn-sm" role="button" aria-pressed="true" >[ {{tag}} ]</a>
                  {% endfor%}
              <a href="{% url 'blog:questions-in-categories' question.category.slug %}" class="btn btn-outline-primary btn-sm" role="button" aria-pressed="true">{{question.category}}</a>
       <a href="{% url 'clubuser:profile' question.user.pk %}"role="button" aria-pressed="true">{{question.user.username}}
       {% if question.user.clubuser.image_url %}                    
                  <img src="{{ question.user.clubuser.image_url}}" alt="{% static '/default.jpeg' %}" class="rounded-circle" width="50">
                {% else %}
                  <img src="{% static '/default.jpeg' %}" class="rounded-circle" width="150">

                  {% endif %}</a>


        </h5>
        <div class="card-body">
          <h5 class="card-title">{{question.title}}</h5>
          <p class="card-text">{{ question.body|safe }}</p>
                  <a href="{% url 'blog:write-answer' question.pk %}" role="button" class="btn btn-success btn-sm">answer the question</a>
                  {% if user == question.user %}
        <a href="{% url 'blog:update-question' question.pk %}" role="button" class="btn btn-success btn-sm">edit the question</a>
      <a href="{% url 'blog:delete-question' question.pk %}" role="button" class="btn btn-danger btn-sm">delete this question</a>
      {% endif %}
<a href="{% url 'blog:create-report' 'blog' 'question' question.pk %}" role="button" class="btn btn-warning btn-sm">report</a>
  


          <br/><be>
          <br/>
          {% if not user.authenticated  %}
                <form action = "{% url 'blog:create-like' 'blog' 'question' question.pk %}" method="POST">{% csrf_token %}
           {% if user in  question.like.all %}
              <button type = "submit" , name = "question_id", value = "{{question.pk}}", class ="btn btn-secondary btn-sm">unlike</button>
           {%else%}
              <button type = "submit" , name = "question_id", value = "{{question.pk}}", class ="btn btn-danger btn-sm">like</button>
           {% endif %}
           <a role="button" class ="btn btn-primary btn-sm" aria-pressed="true">number of likes : {{question.like.count}}</a>
            <a role="button" class="btn btn-outline-primary btn-sm" aria-pressed="true">Views: {{ question.views_count }} </a>
           </form>
           {% else %}
                      <a href="{% url 'clubuser:signup' %}" aria-pressed="true">log in to like</a>
                     

           {% endif %}
</div>

        </div>
        </div>
        <br/><be>
        <hr>
        <br/>
        <h4>Comments</h4>

                {% for comment  in comments  %}
                <div class="card"  style="width: 69.5rem; height: 7rem">
              <div class="card-body">
                <h5 class="card-title">{{comment.body}} </h5>
                  <a href="{% url 'clubuser:profile' comment.user.pk %}"role="button" aria-pressed="true">{{comment.user}}</a>{{comment.created_date}}

                {% if comment.user == user or request.user.is_staff %}
                      <a href="{% url 'blog:update-comment' comment.pk %}" class="btn btn-primary  btn-sm">update or delete your comment</a>
                {% endif %}                
                        <a href="{% url 'blog:create-report' 'blog' 'QuestionComment' comment.pk  %}" role="button" class="btn btn-warning btn-sm">report</a>
               </div>
            </div>
          {% endfor %}
          
     

  
    <br/><be>
          <hr>
          <br/>

<form method="POST" action = "{% url 'blog:question-comment' question.id %}">{% csrf_token %}
    {{c_form.media}}

    {{ c_form.as_p}}
      <button type = "submit" , name = "question_id", value = "{{question.id}}", class ="btn btn-secondary btn-sm">submit comment</button>
</form>


  
    <br/><be>
          <hr>
          <br/>
{% if answers %}
there is {{ anwers.count }} answer(s) for this question
{% else %}
<h2>Unfortunately this question has no answer yet !!!</h2>
{% endif %}
 <h3> Answers </h3>
  {% for answer in answers%}
    <div class="card" style="width: 69.5rem; height: 15rem">
      <div class="card-body">
  
   <a href="{% url 'clubuser:profile' answer.user.pk %}"role="button" aria-pressed="true"> {{answer.user}} 
         {% if answer.user.clubuser.image_url %}                    
                  <img src="{{ answer.user.clubuser.image_url}}" alt="{% static '/default.jpeg' %}" class="rounded-circle" width="50">
                {% else %}
                  <img src="{% static '/default.jpeg' %}" class="rounded-circle" width="150">
                  {% endif %}</a>
   </a>

        <p class="card-text">{{answer.body|safe}}</p>
{% if user == answer.user %}
        <a href="{% url 'blog:update-answer' answer.pk %}" role="button" class="btn btn-success btn-sm">edit the answer</a>
      <a href="{% url 'blog:delete-answer' answer.pk %}" role="button" class="btn btn-danger btn-sm">delete this answer</a>
      {% endif %}
          <br/><be>
          <br/>
          
           <form action = "{% url 'blog:create-like' 'blog' 'answer' answer.pk %}" method="POST">{% csrf_token %}{{answer.created_date}}
                  {% if user in  answer.like.all %}
              <button type = "submit" , name = "answer_id", value = "{{answer.pk}}", class ="btn btn-danger btn-sm">vote down</button>
                  {%else%}
              <button type = "submit" , name = "answer_id", value = "{{answer.pk}}", class ="btn btn-success btn-sm">vote up</button>
                  {% endif %}
                  <a role="button" class ="btn btn-primary btn-sm" aria-pressed="true">likes : {{answer.like.count}} </a>
                  
                  <a href="{% url 'blog:create-report' 'blog' 'Answer' answer.pk  %}" role="button" class="btn btn-warning btn-sm">report</a>
                  </form>


      </div>
    </div>
{%endfor%}
{% endblock %}

